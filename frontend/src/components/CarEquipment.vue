<script setup lang="ts">
import EquipementExpansionPanel from "@/components/EquipementExpansionPanel.vue";
import {tempCarEquipment} from "@/utils/temporary-car-equipment";
import {carEquipmentTranslations} from "@/translations/CarEquipmentTranslations";
import {onMounted, ref} from "vue";
import type { CarEquipmentKeys, CarEquipmentValues} from "@/types/CarEquipment";

const objectsWithTruthyValues = ref<Record<CarEquipmentKeys, Partial<Record<CarEquipmentValues,boolean | string>>>>({
  audioMultimedia: {},
  comfort: {},
  driveAssistance: {},
  electric: {},
  safety: {},
  performance: {}
})

function setTruthyValues(): void {
  for (const equipmentItem in tempCarEquipment) {
    const typedEquipmentItem = equipmentItem as CarEquipmentKeys;

    Object.keys(tempCarEquipment[typedEquipmentItem]).forEach(equipmentItemKey => {
      const typedEquipmentItemKey = equipmentItemKey as CarEquipmentValues;
      const equipmentValue = tempCarEquipment[typedEquipmentItem][typedEquipmentItemKey];


      if(equipmentValue) {
        objectsWithTruthyValues.value[typedEquipmentItem] = {
          ...objectsWithTruthyValues.value[typedEquipmentItem],
          [typedEquipmentItemKey]: equipmentValue
        };
      }
    })
  }
}

onMounted(() => {
  setTruthyValues();
})

</script>

<template>
  <v-container class="car-equipment-container">
    <v-divider class="pb-2"/>

        <v-expansion-panels variant="accordion">
          <EquipementExpansionPanel
              v-for="equipmentEntry in Object.entries(tempCarEquipment)"
              :title="carEquipmentTranslations[(equipmentEntry[0] as CarEquipmentKeys)].title"
              :translations="carEquipmentTranslations[(equipmentEntry[0] as CarEquipmentKeys)].values"
              :values="objectsWithTruthyValues[(equipmentEntry[0] as CarEquipmentKeys)]"
          />
        </v-expansion-panels>
  </v-container>
</template>

<style scoped lang="scss">
.car-equipment-container {
  padding-top: 0;
}

</style>